version: '3.8'

services:
  gsv-tts-proxy:
    build: .
    container_name: gsv-tts-proxy
    ports:
      - "${PORT:-8000}:8000"
    environment:
      # GSV TTS API 配置
      - GSV_API_URL=${GSV_API_URL:-https://gsv2p.acgnai.top}
      - GSV_API_TOKENS=${GSV_API_TOKENS}
      - GSV_DEFAULT_VOICE=${GSV_DEFAULT_VOICE:-原神-中文-胡桃_ZH}
      - GSV_DEFAULT_MODEL=${GSV_DEFAULT_MODEL:-GSVI-v4}
      # NewAPI 配置（用于 LLM 代理）
      - NEWAPI_BASE_URL=${NEWAPI_BASE_URL}
      - NEWAPI_API_KEY=${NEWAPI_API_KEY}
      - NEWAPI_TIMEOUT=${NEWAPI_TIMEOUT:-120}
      # TTS 配置
      - TTS_REQUEST_TIMEOUT=${TTS_REQUEST_TIMEOUT:-60}
      - TTS_RETRY_COUNT=${TTS_RETRY_COUNT:-2}
      # 缓存配置
      - CACHE_MAX_SIZE=${CACHE_MAX_SIZE:-1000}
      - CACHE_TTL=${CACHE_TTL:-3600}
      - CACHE_CLEANUP_INTERVAL=${CACHE_CLEANUP_INTERVAL:-300}
      # 文本分段配置
      - SPLITTER_MAX_LEN=${SPLITTER_MAX_LEN:-40}
      - SPLITTER_MIN_LEN=${SPLITTER_MIN_LEN:-5}
      # 日志级别
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s